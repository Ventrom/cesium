define(["exports","./Cartesian2-15709417","./when-54c2dc71","./Check-6c0211bc","./EllipsoidGeodesic-e0adc5e7","./EllipsoidRhumbLine-281c49be","./IntersectionTests-9d9af9db","./Math-fbfbe3b1","./Transforms-c00dcfdd","./Plane-ff99a7c3"],function(a,w,P,T,e,v,m,y,b,A){"use strict";var E={numberOfPoints:function(a,e,r){var i=w.Cartesian3.distance(a,e);return Math.ceil(i/r)},numberOfPointsRhumbLine:function(a,e,r){var i=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(i/(r*r))))}},o=new w.Cartographic;E.extractHeights=function(a,e){for(var r=a.length,i=new Array(r),t=0;t<r;t++){var n=a[t];i[t]=e.cartesianToCartographic(n,o).height}return i};var R=new b.Matrix4,M=new w.Cartesian3,S=new w.Cartesian3,D=new A.Plane(w.Cartesian3.UNIT_X,0),x=new w.Cartesian3,N=new A.Plane(w.Cartesian3.UNIT_X,0),G=new w.Cartesian3,I=new w.Cartesian3,k=[];function V(a,e,r){var i,t=k;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}var n=(r-e)/a;for(i=0;i<a;i++){var o=e+i*n;t[i]=o}return t}var L=new w.Cartographic,_=new w.Cartographic,O=new w.Cartesian3,B=new w.Cartesian3,U=new w.Cartesian3,q=new e.EllipsoidGeodesic,z=new v.EllipsoidRhumbLine;function X(a,e,r,i,t,n,o,s){var c=i.scaleToGeodeticSurface(a,B),l=i.scaleToGeodeticSurface(e,U),u=E.numberOfPoints(a,e,r),h=i.cartesianToCartographic(c,L),f=i.cartesianToCartographic(l,_),d=V(u,t,n);q.setEndPoints(h,f);var p=q.surfaceDistance/u,g=s;h.height=t;var C=i.cartographicToCartesian(h,O);w.Cartesian3.pack(C,o,g),g+=3;for(var v=1;v<u;v++){var m=q.interpolateUsingSurfaceDistance(v*p,_);m.height=d[v],C=i.cartographicToCartesian(m,O),w.Cartesian3.pack(C,o,g),g+=3}return g}function W(a,e,r,i,t,n,o,s){var c=i.cartesianToCartographic(a,L),l=i.cartesianToCartographic(e,_),u=E.numberOfPointsRhumbLine(c,l,r);c.height=0,l.height=0;var h=V(u,t,n);z.ellipsoid.equals(i)||(z=new v.EllipsoidRhumbLine(void 0,void 0,i)),z.setEndPoints(c,l);var f=z.surfaceDistance/u,d=s;c.height=t;var p=i.cartographicToCartesian(c,O);w.Cartesian3.pack(p,o,d),d+=3;for(var g=1;g<u;g++){var C=z.interpolateUsingSurfaceDistance(g*f,_);C.height=h[g],p=i.cartographicToCartesian(C,O),w.Cartesian3.pack(p,o,d),d+=3}return d}E.wrapLongitude=function(a,e){var r=[],i=[];if(P.defined(a)&&0<a.length){e=P.defaultValue(e,b.Matrix4.IDENTITY);var t=b.Matrix4.inverseTransformation(e,R),n=b.Matrix4.multiplyByPoint(t,w.Cartesian3.ZERO,M),o=w.Cartesian3.normalize(b.Matrix4.multiplyByPointAsVector(t,w.Cartesian3.UNIT_Y,S),S),s=A.Plane.fromPointNormal(n,o,D),c=w.Cartesian3.normalize(b.Matrix4.multiplyByPointAsVector(t,w.Cartesian3.UNIT_X,x),x),l=A.Plane.fromPointNormal(n,c,N),u=1;r.push(w.Cartesian3.clone(a[0]));for(var h=r[0],f=a.length,d=1;d<f;++d){var p=a[d];if(A.Plane.getPointDistance(l,h)<0||A.Plane.getPointDistance(l,p)<0){var g=m.IntersectionTests.lineSegmentPlane(h,p,s,G);if(P.defined(g)){var C=w.Cartesian3.multiplyByScalar(o,5e-9,I);A.Plane.getPointDistance(s,h)<0&&w.Cartesian3.negate(C,C),r.push(w.Cartesian3.add(g,C,new w.Cartesian3)),i.push(u+1),w.Cartesian3.negate(C,C),r.push(w.Cartesian3.add(g,C,new w.Cartesian3)),u=1}}r.push(w.Cartesian3.clone(a[d])),u++,h=p}i.push(u)}return{positions:r,lengths:i}},E.generateArc=function(a){P.defined(a)||(a={});var e=a.positions;if(!P.defined(e))throw new T.DeveloperError("options.positions is required.");var r=e.length,i=P.defaultValue(a.ellipsoid,w.Ellipsoid.WGS84),t=P.defaultValue(a.height,0),n=Array.isArray(t);if(r<1)return[];if(1===r){var o=i.scaleToGeodeticSurface(e[0],B);if(0!==(t=n?t[0]:t)){var s=i.geodeticSurfaceNormal(o,O);w.Cartesian3.multiplyByScalar(s,t,s),w.Cartesian3.add(o,s,o)}return[o.x,o.y,o.z]}var c=a.minDistance;if(!P.defined(c)){var l=P.defaultValue(a.granularity,y.CesiumMath.RADIANS_PER_DEGREE);c=y.CesiumMath.chordLength(l,i.maximumRadius)}var u,h=0;for(u=0;u<r-1;u++)h+=E.numberOfPoints(e[u],e[u+1],c);var f=3*(h+1),d=new Array(f),p=0;for(u=0;u<r-1;u++){p=X(e[u],e[u+1],c,i,n?t[u]:t,n?t[u+1]:t,d,p)}k.length=0;var g=e[r-1],C=i.cartesianToCartographic(g,L);C.height=n?t[r-1]:t;var v=i.cartographicToCartesian(C,O);return w.Cartesian3.pack(v,d,f-3),d};var Y=new w.Cartographic,H=new w.Cartographic;E.generateRhumbArc=function(a){P.defined(a)||(a={});var e=a.positions;if(!P.defined(e))throw new T.DeveloperError("options.positions is required.");var r=e.length,i=P.defaultValue(a.ellipsoid,w.Ellipsoid.WGS84),t=P.defaultValue(a.height,0),n=Array.isArray(t);if(r<1)return[];if(1===r){var o=i.scaleToGeodeticSurface(e[0],B);if(0!==(t=n?t[0]:t)){var s=i.geodeticSurfaceNormal(o,O);w.Cartesian3.multiplyByScalar(s,t,s),w.Cartesian3.add(o,s,o)}return[o.x,o.y,o.z]}var c,l,u=P.defaultValue(a.granularity,y.CesiumMath.RADIANS_PER_DEGREE),h=0,f=i.cartesianToCartographic(e[0],Y);for(c=0;c<r-1;c++)l=i.cartesianToCartographic(e[c+1],H),h+=E.numberOfPointsRhumbLine(f,l,u),f=w.Cartographic.clone(l,Y);var d=3*(h+1),p=new Array(d),g=0;for(c=0;c<r-1;c++){g=W(e[c],e[c+1],u,i,n?t[c]:t,n?t[c+1]:t,p,g)}k.length=0;var C=e[r-1],v=i.cartesianToCartographic(C,L);v.height=n?t[r-1]:t;var m=i.cartographicToCartesian(v,O);return w.Cartesian3.pack(m,p,d-3),p},E.generateCartesianArc=function(a){for(var e=E.generateArc(a),r=e.length/3,i=new Array(r),t=0;t<r;t++)i[t]=w.Cartesian3.unpack(e,3*t);return i},E.generateCartesianRhumbArc=function(a){for(var e=E.generateRhumbArc(a),r=e.length/3,i=new Array(r),t=0;t<r;t++)i[t]=w.Cartesian3.unpack(e,3*t);return i},a.PolylinePipeline=E});
//# sourceMappingURL=PolylinePipeline-53cbf02f.js.map
