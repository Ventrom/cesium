define(["./when-54c2dc71","./Cartesian2-15709417","./ArcType-dc1c5aee","./arrayRemoveDuplicates-b5ccac6b","./Transforms-c00dcfdd","./Color-e465730a","./ComponentDatatype-a26dd044","./Check-6c0211bc","./GeometryAttribute-c2f3a6a0","./GeometryAttributes-4fcfcf40","./IndexDatatype-eaebd63b","./Math-fbfbe3b1","./PolylinePipeline-53cbf02f","./VertexFormat-4d8b817a","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./EllipsoidGeodesic-e0adc5e7","./EllipsoidRhumbLine-281c49be","./IntersectionTests-9d9af9db","./Plane-ff99a7c3"],function(J,j,K,Q,X,Z,$,y,ee,te,re,ae,oe,f,e,t,r,a,o,n){"use strict";var ne=[];function ie(e,t,r,a,o){var n,i=ne;i.length=o;var l=r.red,s=r.green,p=r.blue,d=r.alpha,c=a.red,u=a.green,y=a.blue,f=a.alpha;if(Z.Color.equals(r,a)){for(n=0;n<o;n++)i[n]=Z.Color.clone(r);return i}var h=(c-l)/o,m=(u-s)/o,v=(y-p)/o,C=(f-d)/o;for(n=0;n<o;n++)i[n]=new Z.Color(l+n*h,s+n*m,p+n*v,d+n*C);return i}function h(e){var t=(e=J.defaultValue(e,J.defaultValue.EMPTY_OBJECT)).positions,r=e.colors,a=J.defaultValue(e.width,1),o=J.defaultValue(e.colorsPerVertex,!1);if(!J.defined(t)||t.length<2)throw new y.DeveloperError("At least two positions are required.");if("number"!=typeof a)throw new y.DeveloperError("width must be a number");if(J.defined(r)&&(o&&r.length<t.length||!o&&r.length<t.length-1))throw new y.DeveloperError("colors has an invalid length.");this._positions=t,this._colors=r,this._width=a,this._colorsPerVertex=o,this._vertexFormat=f.VertexFormat.clone(J.defaultValue(e.vertexFormat,f.VertexFormat.DEFAULT)),this._arcType=J.defaultValue(e.arcType,K.ArcType.GEODESIC),this._granularity=J.defaultValue(e.granularity,ae.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=j.Ellipsoid.clone(J.defaultValue(e.ellipsoid,j.Ellipsoid.WGS84)),this._workerName="createPolylineGeometry";var n=1+t.length*j.Cartesian3.packedLength;n+=J.defined(r)?1+r.length*Z.Color.packedLength:1,this.packedLength=n+j.Ellipsoid.packedLength+f.VertexFormat.packedLength+4}h.pack=function(e,t,r){if(!J.defined(e))throw new y.DeveloperError("value is required");if(!J.defined(t))throw new y.DeveloperError("array is required");var a;r=J.defaultValue(r,0);var o=e._positions,n=o.length;for(t[r++]=n,a=0;a<n;++a,r+=j.Cartesian3.packedLength)j.Cartesian3.pack(o[a],t,r);var i=e._colors;for(n=J.defined(i)?i.length:0,t[r++]=n,a=0;a<n;++a,r+=Z.Color.packedLength)Z.Color.pack(i[a],t,r);return j.Ellipsoid.pack(e._ellipsoid,t,r),r+=j.Ellipsoid.packedLength,f.VertexFormat.pack(e._vertexFormat,t,r),r+=f.VertexFormat.packedLength,t[r++]=e._width,t[r++]=e._colorsPerVertex?1:0,t[r++]=e._arcType,t[r]=e._granularity,t};var m=j.Ellipsoid.clone(j.Ellipsoid.UNIT_SPHERE),v=new f.VertexFormat,C={positions:void 0,colors:void 0,ellipsoid:m,vertexFormat:v,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};h.unpack=function(e,t,r){if(!J.defined(e))throw new y.DeveloperError("array is required");var a;t=J.defaultValue(t,0);var o=e[t++],n=new Array(o);for(a=0;a<o;++a,t+=j.Cartesian3.packedLength)n[a]=j.Cartesian3.unpack(e,t);var i=0<(o=e[t++])?new Array(o):void 0;for(a=0;a<o;++a,t+=Z.Color.packedLength)i[a]=Z.Color.unpack(e,t);var l=j.Ellipsoid.unpack(e,t,m);t+=j.Ellipsoid.packedLength;var s=f.VertexFormat.unpack(e,t,v);t+=f.VertexFormat.packedLength;var p=e[t++],d=1===e[t++],c=e[t++],u=e[t];return J.defined(r)?(r._positions=n,r._colors=i,r._ellipsoid=j.Ellipsoid.clone(l,r._ellipsoid),r._vertexFormat=f.VertexFormat.clone(s,r._vertexFormat),r._width=p,r._colorsPerVertex=d,r._arcType=c,r._granularity=u,r):(C.positions=n,C.colors=i,C.width=p,C.colorsPerVertex=d,C.arcType=c,C.granularity=u,new h(C))};var le=new j.Cartesian3,se=new j.Cartesian3,pe=new j.Cartesian3,de=new j.Cartesian3;return h.createGeometry=function(e){var t,r,a,o=e._width,n=e._vertexFormat,i=e._colors,l=e._colorsPerVertex,s=e._arcType,p=e._granularity,d=e._ellipsoid,c=Q.arrayRemoveDuplicates(e._positions,j.Cartesian3.equalsEpsilon),u=c.length;if(!(u<2||o<=0)){if(s===K.ArcType.GEODESIC||s===K.ArcType.RHUMB){var y,f;f=s===K.ArcType.GEODESIC?(y=ae.CesiumMath.chordLength(p,d.maximumRadius),oe.PolylinePipeline.numberOfPoints):(y=p,oe.PolylinePipeline.numberOfPointsRhumbLine);var h=oe.PolylinePipeline.extractHeights(c,d);if(J.defined(i)){var m=1;for(t=0;t<u-1;++t)m+=f(c[t],c[t+1],y);var v=new Array(m),C=0;for(t=0;t<u-1;++t){var g=c[t],w=c[t+1],b=i[t],E=f(g,w,y);if(l&&t<m){var _=ie(0,0,b,i[t+1],E),A=_.length;for(r=0;r<A;++r)v[C++]=_[r]}else for(r=0;r<E;++r)v[C++]=Z.Color.clone(b)}v[C]=Z.Color.clone(i[i.length-1]),i=v,ne.length=0}c=s===K.ArcType.GEODESIC?oe.PolylinePipeline.generateCartesianArc({positions:c,minDistance:y,ellipsoid:d,height:h}):oe.PolylinePipeline.generateCartesianRhumbArc({positions:c,granularity:y,ellipsoid:d,height:h})}var P,D=4*(u=c.length)-4,T=new Float64Array(3*D),x=new Float64Array(3*D),k=new Float64Array(3*D),V=new Float32Array(2*D),L=n.st?new Float32Array(2*D):void 0,F=J.defined(i)?new Uint8Array(4*D):void 0,G=0,O=0,R=0,I=0;for(r=0;r<u;++r){var S,B;0===r?(P=le,j.Cartesian3.subtract(c[0],c[1],P),j.Cartesian3.add(c[0],P,P)):P=c[r-1],j.Cartesian3.clone(P,pe),j.Cartesian3.clone(c[r],se),r===u-1?(P=le,j.Cartesian3.subtract(c[u-1],c[u-2],P),j.Cartesian3.add(c[u-1],P,P)):P=c[r+1],j.Cartesian3.clone(P,de),J.defined(F)&&(S=0===r||l?i[r]:i[r-1],r!==u-1&&(B=i[r]));var U=r===u-1?2:4;for(a=0===r?2:0;a<U;++a){j.Cartesian3.pack(se,T,G),j.Cartesian3.pack(pe,x,G),j.Cartesian3.pack(de,k,G),G+=3;var N=a-2<0?-1:1;if(V[O++]=a%2*2-1,V[O++]=N*o,n.st&&(L[R++]=r/(u-1),L[R++]=Math.max(V[O-2],0)),J.defined(F)){var q=a<2?S:B;F[I++]=Z.Color.floatToByte(q.red),F[I++]=Z.Color.floatToByte(q.green),F[I++]=Z.Color.floatToByte(q.blue),F[I++]=Z.Color.floatToByte(q.alpha)}}}var M=new te.GeometryAttributes;M.position=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:T}),M.prevPosition=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:x}),M.nextPosition=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:k}),M.expandAndWidth=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V}),n.st&&(M.st=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L})),J.defined(F)&&(M.color=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:F,normalize:!0}));var H=re.IndexDatatype.createTypedArray(D,6*u-6),W=0,Y=0,z=u-1;for(r=0;r<z;++r)H[Y++]=W,H[Y++]=W+2,H[Y++]=W+1,H[Y++]=W+1,H[Y++]=W+2,H[Y++]=W+3,W+=4;return new ee.Geometry({attributes:M,indices:H,primitiveType:ee.PrimitiveType.TRIANGLES,boundingSphere:X.BoundingSphere.fromPoints(c),geometryType:ee.GeometryType.POLYLINES})}},function(e,t){return J.defined(t)&&(e=h.unpack(e,t)),e._ellipsoid=j.Ellipsoid.clone(e._ellipsoid),h.createGeometry(e)}});
//# sourceMappingURL=createPolylineGeometry.js.map
